# 串口通信
$\qquad$串口通信（Serial Communication）是一种通过串行接口按位传输数据的通信方式。
$\qquad$STM32提供UART （Universal Asynchronous Receiver/Transmitter，异步串行通信协议），USART （Universal Synchronous/Asynchronous Receiver/Transmitter，同步串行通信协议）两种模式。
## 通信方式

### 按数据传输方式分
- 串行（Serial）：数据依靠单一线路，一位一位地按顺序传输。这种方式优点是连线少，成本低，尤其适合远距离传输和资源受限的场合。
- 并行（Parallel）：数据依靠多条线路，一次传输多位数据。这种方式的数据吞吐量大，但需要更多的连线和同步机制，通常用于短距离和高速数据传输。
### 按数据传输方向分
- 单工（Simplex）：只能单向通信，如收音机。
- 半双工（Half Duplex）：双向通信但不能同时进行，如对讲机。
- 全双工（Full Duplex）：双向通信可同时进行，如电话。
### 按时钟控制方式分
- 同步（Synchronous）：依靠共享时钟信号，时序精确，如SPI、USART 同步模式。
- 异步（Asynchronous）：没有时钟线，靠起始位/停止位来同步，如UART、USART 异步模式。
## USART的工作模式
- 异步模式（Asynchronous）：就是UART的功能，只需要Tx和Rx
-  同步模式（Synchronous）：在Tx、Rx外新增时钟线CK
- 单线半双工模式（Single Wire(Half-duplex)）：只需要一根线，Tx和Rx复用
- 多处理器通信（Multiprocessor Communication）：一个主机通过Tx发送数据，多个从机通过Rx接收数据。主机发送的数据含有地址位，从机在检测到地址位或总线空闲时会解除静默模式，参与通信
- IrDA模式（Infrared Data Association）：红外通信协议，通过红外光进行短距离无线数据传输，TX引脚连接驱动电路（如TFDU4101），将电信号转换为红外光；RX引脚通过光电二极管接收红外信号。
- LIN模式（Local Interconnect Network）：本地互连网络，汽车中常用的低速通信协议
- 智能卡模式（Smart Card）：用来对接智能卡协议（ISO 7816），包含特定帧结构和校验要求
## UART的结构
![[串口的链接结构.png]]
Tx接Rx，Rx接Tx
UART采用TTL（Transitor-Transitor Logic，晶体管-晶体管逻辑）逻辑电平标准：
高电平（逻辑1）：通常为3.3V或5V；低电平（逻辑0）：0V～0.8V
需要通过USB-TTL转接口才能连接到电脑上
## UART传输的数据格式
![[串口的数据帧格式.png]]
- 起始位：一个下降沿宣布开始传输
- 数据位：具体的传输信号
- 停止位：拉回到高电平宣布停止传输

一般传输时是8位8位地传输，所所以第一种和第四种更常用
校验位有奇校验和偶校验等等手段
## 比特率和波特率
波特率（Baud Rate）：表示信号状态变化的速率，单位是Baud（Bd）或Bits/s，衡量传输媒介上信号每秒变化的次数，关注的是物理信号的变化。

比特率（Bit Rate/bps）：表示数据传输的速率，单位是Bits/s，衡量每秒通过信道传输的有效信息比特的数量，关注的是通过信道的有效信息。二者的关系：
$$比特率=波特率\times \log_2M$$
 $\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad$其中M为信号状态数或调制电平数
若信号为1位二进制信号，则信号有2个状态，$M$为2；
若信号为$n$位二进制信号，则信号有$2^n$个状态，$M$为$2^n$；（并行传输）
若信号有A，B，C三种状态，则$M$为3。
## UART的各种参数
- 波特率Baud Rate
- 数据位长度Word Length：8位或9位
- 校验奇偶性Parity：奇校验Odd Parity、偶校验Even Parity、或不使用
- 停止位长度Stop Bits：1位或两位
- 数据方向：只发、只收、或既发又收